# =============================================================================
# Event Chat Operations
# =============================================================================

# Queries (cursor-based)
query GetIntentMessages(
  $intentId: ID!
  $first: Int = 20
  $before: String
  $after: String
) {
  intentMessages(
    intentId: $intentId
    first: $first
    before: $before
    after: $after
  ) {
    edges {
      node {
        ...IntentChatMessageWithReply
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

query GetIntentUnreadCount($intentId: ID!) {
  intentUnreadCount(intentId: $intentId)
}

# Mutations
mutation SendIntentMessage($input: SendIntentMessageInput!) {
  sendIntentMessage(input: $input) {
    ...IntentChatMessageWithReply
  }
}

mutation EditIntentMessage($id: ID!, $input: EditIntentMessageInput!) {
  editIntentMessage(id: $id, input: $input) {
    ...IntentChatMessageWithReply
  }
}

mutation DeleteIntentMessage($id: ID!, $soft: Boolean = true) {
  deleteIntentMessage(id: $id, soft: $soft)
}

mutation MarkIntentChatRead($intentId: ID!, $at: DateTime) {
  markIntentChatRead(intentId: $intentId, at: $at)
}

# Mute/unmute an intent chat
mutation MuteIntent($intentId: ID!, $muted: Boolean!) {
  muteIntent(intentId: $intentId, muted: $muted) {
    ...IntentMuteCore
  }
}

# Publish typing indicator
mutation PublishIntentTyping($intentId: ID!, $isTyping: Boolean!) {
  publishIntentTyping(intentId: $intentId, isTyping: $isTyping)
}

# Subscriptions
subscription OnIntentMessageAdded($intentId: ID!) {
  intentMessageAdded(intentId: $intentId) {
    ...IntentChatMessageWithReply
  }
}

subscription OnIntentMessageUpdated($intentId: ID!) {
  intentMessageUpdated(intentId: $intentId) {
    ...IntentChatMessageWithReply
  }
}

subscription OnIntentMessageDeleted($intentId: ID!) {
  intentMessageDeleted(intentId: $intentId) {
    messageId
    deletedAt
  }
}

subscription OnIntentTyping($intentId: ID!) {
  intentTyping(intentId: $intentId) {
    userId
    isTyping
  }
}
