# =============================================================================
# Event Chat Operations
# =============================================================================

# Queries (cursor-based)
query GetEventMessages(
  $eventId: ID!
  $first: Int = 20
  $before: String
  $after: String
) {
  eventMessages(
    eventId: $eventId
    first: $first
    before: $before
    after: $after
  ) {
    edges {
      node {
        ...EventChatMessageWithReply
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

query GetEventUnreadCount($eventId: ID!) {
  eventUnreadCount(eventId: $eventId)
}

# Mutations
mutation SendEventMessage($input: SendEventMessageInput!) {
  sendEventMessage(input: $input) {
    ...EventChatMessageWithReply
  }
}

mutation EditEventMessage($id: ID!, $input: EditEventMessageInput!) {
  editEventMessage(id: $id, input: $input) {
    ...EventChatMessageWithReply
  }
}

mutation DeleteEventMessage($id: ID!, $soft: Boolean = true) {
  deleteEventMessage(id: $id, soft: $soft)
}

mutation MarkEventChatRead($eventId: ID!, $at: DateTime) {
  markEventChatRead(eventId: $eventId, at: $at)
}

# Mute/unmute an event chat
mutation MuteEvent($eventId: ID!, $muted: Boolean!) {
  muteEvent(eventId: $eventId, muted: $muted) {
    ...EventMuteCore
  }
}

# Publish typing indicator
mutation PublishEventTyping($eventId: ID!, $isTyping: Boolean!) {
  publishEventTyping(eventId: $eventId, isTyping: $isTyping)
}

# Subscriptions
subscription OnEventMessageAdded($eventId: ID!) {
  eventMessageAdded(eventId: $eventId) {
    ...EventChatMessageWithReply
  }
}

subscription OnEventMessageUpdated($eventId: ID!) {
  eventMessageUpdated(eventId: $eventId) {
    ...EventChatMessageWithReply
  }
}

subscription OnEventMessageDeleted($eventId: ID!) {
  eventMessageDeleted(eventId: $eventId) {
    messageId
    deletedAt
  }
}

subscription OnEventTyping($eventId: ID!) {
  eventTyping(eventId: $eventId) {
    userId
    isTyping
  }
}
