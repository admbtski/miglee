# =============================================================================
# Core Fragments - Base entities
# =============================================================================

fragment SessionUserCore on SessionUser {
  id
  name
  email
  role
  imageUrl
  verifiedAt
}

fragment UserCore on User {
  id
  email
  name
  role
  imageUrl
  verifiedAt
  createdAt
  updatedAt
  lastSeenAt
}

fragment CategoryCore on Category {
  id
  slug
  names # JSONObject with translated labels by locale
  icon
  color
  createdAt
  updatedAt
}

fragment TagCore on Tag {
  id
  label
  slug
  createdAt
  updatedAt
}

# =============================================================================
# Intent Member Fragments
# =============================================================================

fragment IntentMemberCore on IntentMember {
  id
  intentId
  userId
  role
  status
  joinedAt
  leftAt
  note
  user {
    ...UserCore
  }
  addedBy {
    id
    name
    imageUrl
  }
}

# Lightweight member fragment (for lists)
fragment IntentMemberLight on IntentMember {
  id
  role
  status
  joinedAt
  user {
    id
    name
    imageUrl
  }
}

# =============================================================================
# Intent Fragments
# =============================================================================

# Lightweight intent fragment (for lists/cards)
fragment IntentLight on Intent {
  id
  title
  description

  visibility
  mode
  min
  max

  startAt
  endAt
  allowJoinLate

  meetingKind
  onlineUrl

  lat
  lng
  address
  placeId
  radiusKm

  levels

  # Computed helpers
  joinedCount
  isFull
  hasStarted
  hasEnded
  isCanceled
  isDeleted

  createdAt
  updatedAt

  categories {
    ...CategoryCore
  }
  tags {
    ...TagCore
  }

  owner {
    id
    name
    imageUrl
  }
}

# Full intent fragment (for detail views)
fragment IntentCore on Intent {
  id
  title
  description
  notes

  visibility
  mode
  min
  max

  startAt
  endAt
  allowJoinLate

  meetingKind
  onlineUrl

  lat
  lng
  address
  placeId
  radiusKm

  levels

  # Computed helpers (resolver-calculated)
  joinedCount
  isFull
  hasStarted
  hasEnded

  # Cancellation (read-only)
  canceledAt
  canceledBy {
    ...UserCore
  }
  cancelReason
  isCanceled

  # Soft-delete (typically set 30+ days after cancellation)
  deletedAt
  deletedBy {
    ...UserCore
  }
  deleteReason
  isDeleted

  createdAt
  updatedAt

  categories {
    ...CategoryCore
  }
  tags {
    ...TagCore
  }

  # Convenience relations (resolver-calculated / access-controlled)
  owner {
    ...UserCore
  }
  members {
    ...IntentMemberCore
  }
}

# =============================================================================
# Notification Fragments
# =============================================================================

fragment NotificationCore on Notification {
  id
  kind
  title
  body
  data
  dedupeKey
  entityType
  entityId
  readAt
  createdAt

  recipient {
    ...UserCore
  }
  actor {
    id
    name
    imageUrl
  }

  # Convenience relation when entityType=INTENT
  intent {
    id
    title
    startAt
  }
}

fragment NotificationBadgeChangedCore on NotificationBadgeChanged {
  recipientId
}
# =============================================================================
# Pagination Fragments
# =============================================================================

fragment PageInfoCore on PageInfo {
  total
  limit
  offset
  hasNext
  hasPrev
}

fragment UsersResultCore on UsersResult {
  items {
    ...UserCore
  }
  pageInfo {
    ...PageInfoCore
  }
}

fragment IntentsResultCore on IntentsResult {
  items {
    ...IntentCore
  }
  pageInfo {
    ...PageInfoCore
  }
}

# Lightweight intents result (for lists)
fragment IntentsResultLight on IntentsResult {
  items {
    ...IntentLight
  }
  pageInfo {
    ...PageInfoCore
  }
}
