# =============================================================================
# DM Queries
# =============================================================================

# Get all DM threads for current user
query GetDmThreads(
  $limit: Int = 20
  $offset: Int = 0
  $unreadOnly: Boolean = false
) {
  dmThreads(limit: $limit, offset: $offset, unreadOnly: $unreadOnly) {
    ...DmThreadsResultCore
  }
}

# Get a specific DM thread by ID or by other user ID
query GetDmThread($id: ID, $otherUserId: ID) {
  dmThread(id: $id, otherUserId: $otherUserId) {
    ...DmThreadCore
  }
}

# Get messages in a thread
query GetDmMessages(
  $threadId: ID!
  $limit: Int = 50
  $offset: Int = 0
  $beforeMessageId: ID
) {
  dmMessages(
    threadId: $threadId
    limit: $limit
    offset: $offset
    beforeMessageId: $beforeMessageId
  ) {
    ...DmMessageCore
  }
}

# Get mute status for a thread
query GetDmMute($threadId: ID!) {
  dmMute(threadId: $threadId) {
    ...DmMuteCore
  }
}

# =============================================================================
# DM Mutations
# =============================================================================

# Create or get existing DM thread
mutation CreateOrGetDmThread($userId: ID!) {
  createOrGetDmThread(userId: $userId) {
    ...DmThreadCore
  }
}

# Send a new message (creates thread if doesn't exist)
mutation SendDmMessage($input: SendDmMessageInput!) {
  sendDmMessage(input: $input) {
    ...DmMessageCore
  }
}

# Update an existing message
mutation UpdateDmMessage($id: ID!, $input: UpdateDmMessageInput!) {
  updateDmMessage(id: $id, input: $input) {
    ...DmMessageCore
  }
}

# Delete a message (soft delete)
mutation DeleteDmMessage($id: ID!) {
  deleteDmMessage(id: $id)
}

# Mark a single message as read
mutation MarkDmMessageRead($id: ID!) {
  markDmMessageRead(id: $id)
}

# Mark all messages in a thread as read
mutation MarkDmThreadRead($threadId: ID!) {
  markDmThreadRead(threadId: $threadId)
}

# Delete entire thread
mutation DeleteDmThread($id: ID!) {
  deleteDmThread(id: $id)
}

# Mute/unmute a DM thread
mutation MuteDmThread($threadId: ID!, $muted: Boolean!) {
  muteDmThread(threadId: $threadId, muted: $muted) {
    ...DmMuteCore
  }
}

# Publish typing indicator
mutation PublishDmTyping($threadId: ID!, $isTyping: Boolean!) {
  publishDmTyping(threadId: $threadId, isTyping: $isTyping)
}

# =============================================================================
# DM Subscriptions
# =============================================================================

# Subscribe to new messages in a thread
subscription OnDmMessageAdded($threadId: ID!) {
  dmMessageAdded(threadId: $threadId) {
    ...DmMessageCore
  }
}

# Subscribe to message updates in a thread
subscription OnDmMessageUpdated($threadId: ID!) {
  dmMessageUpdated(threadId: $threadId) {
    ...DmMessageCore
  }
}

# Subscribe to message deletions in a thread
subscription OnDmMessageDeleted($threadId: ID!) {
  dmMessageDeleted(threadId: $threadId) {
    messageId
    deletedAt
  }
}

# Subscribe to typing indicators in a thread
subscription OnDmTyping($threadId: ID!) {
  dmTyping(threadId: $threadId) {
    userId
    isTyping
  }
}
