"""
Custom scalars
"""
scalar DateTime
scalar JSON
scalar JSONObject

# ------------------------------------------------------------------------------
# Enums
# ------------------------------------------------------------------------------

enum UsersSortBy {
  NAME
  CREATED_AT
  ROLE
  VERIFIED_AT
}

enum SortDir {
  ASC
  DESC
}

enum IntentsSortBy {
  START_AT
  CREATED_AT
  UPDATED_AT
  MEMBERS_COUNT
}

type PageInfo {
  total: Int!
  limit: Int!
  offset: Int!
  hasNext: Boolean!
  hasPrev: Boolean!
}

type CursorPageInfo {
  hasNextPage: Boolean!
  endCursor: String
}

type UsersResult {
  items: [User!]!
  pageInfo: PageInfo!
}

type IntentsResult {
  items: [Intent!]!
  pageInfo: PageInfo!
}

type NotificationsResult {
  items: [Notification!]!
  pageInfo: PageInfo!
}

input UsersSort {
  by: UsersSortBy! = CREATED_AT
  dir: SortDir! = DESC
}

"Visibility of an intent"
enum Visibility {
  PUBLIC
  HIDDEN
}

enum AddressVisibility {
  PUBLIC
  AFTER_JOIN
  HIDDEN
}

enum MembersVisibility {
  PUBLIC
  AFTER_JOIN
  HIDDEN
}

"Join mode - how users can join an intent"
enum JoinMode {
  OPEN
  REQUEST
  INVITE_ONLY
}

"Meeting mode / capacity grouping"
enum Mode {
  ONE_TO_ONE
  GROUP
}

"How the meeting happens"
enum MeetingKind {
  ONSITE
  ONLINE
  HYBRID
}

"User role (global)"
enum Role {
  ADMIN
  MODERATOR
  USER
}

"Skill / difficulty level (enum array in DB)"
enum Level {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

"Per-intent role"
enum IntentMemberRole {
  OWNER
  MODERATOR
  PARTICIPANT
}

"Membership lifecycle status"
enum IntentMemberStatus {
  JOINED
  PENDING
  INVITED
  REJECTED
  BANNED
  LEFT
  KICKED
}

"Member event type for audit log"
enum MemberEvent {
  JOIN
  REQUEST
  APPROVE
  REJECT
  LEAVE
  KICK
  BAN
  UNBAN
  INVITE
  ACCEPT_INVITE
}

"High-level notification category/kind"
enum NotificationKind {
  INTENT_CREATED
  INTENT_UPDATED
  INTENT_CANCELED
  INTENT_DELETED
  INTENT_INVITE
  INTENT_MEMBERSHIP_APPROVED
  INTENT_MEMBERSHIP_REJECTED
  INTENT_REMINDER
  JOIN_REQUEST
  NEW_MESSAGE
  NEW_COMMENT
  NEW_REVIEW
  BANNED
  UNBANNED
  SYSTEM
}

"Polymorphic target for notifications (deep-link)"
enum NotificationEntity {
  INTENT
  MESSAGE
  PAYMENT
  INVOICE
  USER
  REVIEW
  SYSTEM
  OTHER
}

"Report entity type"
enum ReportEntity {
  INTENT
  COMMENT
  REVIEW
  USER
  MESSAGE
}

"Subscription plan tiers"
enum SubscriptionPlan {
  BASIC
  PLUS
  PRO
}

"Subscription status"
enum SubscriptionStatus {
  INCOMPLETE
  TRIALING
  ACTIVE
  PAST_DUE
  CANCELED
  UNPAID
  PAUSED
}

"Event sponsorship plan tiers"
enum SponsorPlan {
  BASIC
  PLUS
  PRO
}

"Sponsorship status"
enum SponsorshipStatus {
  PENDING
  ACTIVE
  EXPIRED
  CANCELED
}

"Intent dynamic status (computed on read)"
enum IntentStatus {
  ANY
  ONGOING
  PAST
  FULL
  LOCKED
  AVAILABLE
  CANCELED
  DELETED
}

"Why joining is locked (computed)"
enum JoinLockReason {
  FULL
  INVITE_ONLY
  NOT_OPEN_YET
  CUTOFF
  NO_LATE_JOIN
  LATE_CUTOFF
  MANUAL
  ENDED
  CANCELED
  DELETED
  OTHER
}

# ------------------------------------------------------------------------------
# Types
# ------------------------------------------------------------------------------

"Session"
type SessionUser {
  id: String!
  name: String!
  email: String!
  role: Role!
  imageUrl: String
  verifiedAt: DateTime
}

"User"
type User {
  id: ID!
  email: String!
  name: String!
  imageUrl: String
  role: Role!
  verifiedAt: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
  lastSeenAt: DateTime

  # Profile / Preferences
  locale: String
  tz: String
  acceptedTermsAt: DateTime
  acceptedMarketingAt: DateTime
}

"Category with translated names in JSON, e.g. { pl,de,en }"
type Category {
  id: ID!
  slug: String!
  names: JSONObject!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"Tag used for search/filtering"
type Tag {
  id: ID!
  label: String!
  slug: String!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"Intent membership (user-in-intent)"
type IntentMember {
  id: ID!
  intentId: ID!
  userId: ID!
  role: IntentMemberRole!
  status: IntentMemberStatus!

  addedBy: User
  joinedAt: DateTime
  leftAt: DateTime
  note: String

  user: User!
}

"Intent"
type Intent {
  id: ID!
  title: String!
  description: String
  notes: String

  categories: [Category!]!
  tags: [Tag!]!

  visibility: Visibility!
  joinMode: JoinMode!
  mode: Mode!
  min: Int!
  max: Int!

  startAt: DateTime!
  endAt: DateTime!

  """
  Open joins X minutes before start (null = open immediately after publish)
  """
  joinOpensMinutesBeforeStart: Int

  """
  Close joins before start when now >= startAt - X minutes (null = no pre-start cutoff)
  """
  joinCutoffMinutesBeforeStart: Int

  """
  Allow joining after the event has started (late join)
  """
  allowJoinLate: Boolean!

  """
  Close late join when now >= startAt + X minutes (null = allowed until endAt)
  """
  lateJoinCutoffMinutesAfterStart: Int

  """
  Manual kill-switch for joins; overrides time/cutoff windows
  """
  joinManuallyClosed: Boolean!
  joinManuallyClosedAt: DateTime
  joinManuallyClosedBy: User
  joinManualCloseReason: String

  meetingKind: MeetingKind!
  onlineUrl: String

  lat: Float
  lng: Float
  address: String
  placeId: String
  radiusKm: Float

  # PostgreSQL enum[]
  levels: [Level!]!

  addressVisibility: AddressVisibility!
  membersVisibility: MembersVisibility!

  # Derived counters
  joinedCount: Int!
  commentsCount: Int!
  messagesCount: Int!

  # Ownership
  ownerId: String
  owner: User

  # Access policy: OWNER/MODERATOR can see all statuses; others see JOINED only.
  members: [IntentMember!]!

  # ---------- Computed helpers ----------
  status: IntentStatus! # single, high-level status
  isFull: Boolean!
  hasStarted: Boolean!
  hasEnded: Boolean!
  isOngoing: Boolean!
  canJoin: Boolean! # generic yes/no for primary CTA
  joinOpen: Boolean! # precise: can the viewer join *now*
  lockReason: JoinLockReason # when joinOpen=false, why
  isOnsite: Boolean!
  isOnline: Boolean!
  isHybrid: Boolean!
  withinLock: Boolean! # ← DODAJ TO
  # Cancellation (read-only state)
  canceledAt: DateTime
  canceledBy: User
  cancelReason: String
  isCanceled: Boolean!

  # Soft-delete (read-only state)
  deletedAt: DateTime
  deletedBy: User
  deleteReason: String
  isDeleted: Boolean!

  createdAt: DateTime!
  updatedAt: DateTime!
}

"Notification stored in DB; polymorphic target"
type Notification {
  id: ID!
  kind: NotificationKind!
  title: String
  body: String
  data: JSON
  dedupeKey: String
  readAt: DateTime
  createdAt: DateTime!

  recipient: User!
  actor: User

  entityType: NotificationEntity!
  entityId: ID

  # Convenience: resolved when entityType=INTENT (join on intentId or entityId)
  intent: Intent
}

type NotificationBadgeChanged {
  recipientId: String!
}

# Simple aggregated counters per intent; useful for badges
type IntentMemberStats {
  joined: Int!
  pending: Int!
  invited: Int!
  rejected: Int!
  banned: Int!
  left: Int!
  kicked: Int!
}

# ------------------------------------------------------------------------------
# Direct Messages (DM)
# ------------------------------------------------------------------------------

"Direct message thread between two users"
type DmThread {
  id: ID!
  aUserId: ID!
  bUserId: ID!
  pairKey: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  lastMessageAt: DateTime

  aUser: User!
  bUser: User!
  messages: [DmMessage!]!

  # Computed helpers
  unreadCount: Int!
  lastMessage: DmMessage
}

"Direct message in a thread"
type DmMessage {
  id: ID!
  threadId: ID!
  senderId: ID!
  content: String!
  createdAt: DateTime!
  readAt: DateTime
  deletedAt: DateTime

  thread: DmThread!
  sender: User!
}

"DM thread mute preference"
type DmMute {
  id: ID!
  threadId: ID!
  userId: ID!
  muted: Boolean!
  createdAt: DateTime!

  thread: DmThread!
  user: User!
}

"Paginated DM threads result"
type DmThreadsResult {
  items: [DmThread!]!
  pageInfo: PageInfo!
}

# ------------------------------------------------------------------------------
# Comments
# ------------------------------------------------------------------------------

"Comment on an intent (2-level threading)"
type Comment {
  id: ID!
  intentId: ID!
  authorId: ID!
  threadId: ID!
  parentId: ID
  content: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  deletedAt: DateTime

  intent: Intent!
  author: User!
  parent: Comment
  replies: [Comment!]!

  # Computed
  repliesCount: Int!
}

"Paginated comments result"
type CommentsResult {
  items: [Comment!]!
  pageInfo: PageInfo!
}

# ------------------------------------------------------------------------------
# Reviews
# ------------------------------------------------------------------------------

"Review for an intent (1-5 stars)"
type Review {
  id: ID!
  intentId: ID!
  authorId: ID!
  rating: Int!
  content: String
  createdAt: DateTime!
  updatedAt: DateTime!
  deletedAt: DateTime

  intent: Intent!
  author: User!
}

"Paginated reviews result"
type ReviewsResult {
  items: [Review!]!
  pageInfo: PageInfo!
}

"Review statistics for an intent"
type ReviewStats {
  totalCount: Int!
  averageRating: Float!
  ratingDistribution: [RatingCount!]!
}

"Rating count for a specific star rating"
type RatingCount {
  rating: Int!
  count: Int!
}

# ------------------------------------------------------------------------------
# Reports
# ------------------------------------------------------------------------------

"Report status"
enum ReportStatus {
  OPEN
  INVESTIGATING
  RESOLVED
  DISMISSED
}

"Report for content moderation"
type Report {
  id: ID!
  reporterId: ID!
  entity: ReportEntity!
  entityId: ID!
  reason: String!
  status: ReportStatus!
  createdAt: DateTime!
  resolvedAt: DateTime

  reporter: User!
}

"Paginated reports result"
type ReportsResult {
  items: [Report!]!
  pageInfo: PageInfo!
}

# ------------------------------------------------------------------------------
# Event Chat (Intent Chat Messages)
# ------------------------------------------------------------------------------

"Message in an intent chat room"
type IntentChatMessage {
  id: ID!
  intentId: ID!
  authorId: ID!
  content: String!
  replyToId: ID
  createdAt: DateTime!
  editedAt: DateTime
  deletedAt: DateTime

  intent: Intent!
  author: User!
  replyTo: IntentChatMessage

  # Computed
  isEdited: Boolean!
  isDeleted: Boolean!
}

"Paginated intent chat messages result"
type IntentChatMessagesResult {
  items: [IntentChatMessage!]!
  pageInfo: CursorPageInfo!
  hasMore: Boolean!
}

# ------------------------------------------------------------------------------
# Map Clustering
# ------------------------------------------------------------------------------

"Bounding box for map viewport"
input BBoxInput {
  swLat: Float!
  swLon: Float!
  neLat: Float!
  neLon: Float!
}

"Filters for clustering map intents"
input ClusterFiltersInput {
  categorySlugs: [String!]
  levels: [Level!]
  verifiedOnly: Boolean
}

"Clustered point on the map representing one or more intents"
type Cluster {
  id: ID!
  latitude: Float!
  longitude: Float!
  count: Int!
  region: String!
  geoJson: JSON!
}

"Page metadata for region intents"
type PageMeta {
  page: Int!
  totalItems: Int!
  totalPages: Int!
  prevPage: Int
  nextPage: Int
}

"Paginated result for intents in a map region"
type RegionIntentPage {
  data: [Intent!]!
  meta: PageMeta!
}

# ------------------------------------------------------------------------------
# Inputs
# ------------------------------------------------------------------------------

input CreateCategoryInput {
  slug: String!
  names: JSONObject!
}

input UpdateCategoryInput {
  slug: String
  names: JSONObject
}

input CreateTagInput {
  label: String!
  slug: String!
}

input UpdateTagInput {
  label: String
  slug: String
}

input LocationInput {
  lat: Float
  lng: Float
  address: String
  placeId: String
  radiusKm: Float
}

input CreateIntentInput {
  title: String!
  description: String
  notes: String

  categorySlugs: [String!]!
  tagSlugs: [String!]

  visibility: Visibility! = PUBLIC
  joinMode: JoinMode! = OPEN
  mode: Mode! = GROUP
  min: Int! = 2
  max: Int! = 50

  startAt: DateTime!
  endAt: DateTime!

  # Joins windows / cutoffs
  joinOpensMinutesBeforeStart: Int
  joinCutoffMinutesBeforeStart: Int
  allowJoinLate: Boolean! = true
  lateJoinCutoffMinutesAfterStart: Int

  meetingKind: MeetingKind! = ONSITE
  onlineUrl: String

  location: LocationInput
  levels: [Level!]

  # Privacy
  addressVisibility: AddressVisibility! = PUBLIC
  membersVisibility: MembersVisibility! = PUBLIC
}

input UpdateIntentInput {
  title: String
  categorySlugs: [String!]
  tagSlugs: [String!]
  description: String
  notes: String

  visibility: Visibility
  joinMode: JoinMode
  mode: Mode
  min: Int
  max: Int

  startAt: DateTime
  endAt: DateTime

  # Joins windows / cutoffs
  joinOpensMinutesBeforeStart: Int
  joinCutoffMinutesBeforeStart: Int
  allowJoinLate: Boolean
  lateJoinCutoffMinutesAfterStart: Int
  joinManuallyClosed: Boolean
  joinManualCloseReason: String

  meetingKind: MeetingKind
  onlineUrl: String

  location: LocationInput
  levels: [Level!]

  addressVisibility: AddressVisibility
  membersVisibility: MembersVisibility
}

input InviteMemberInput {
  intentId: ID!
  userId: ID!
}

input ApproveMembershipInput {
  intentId: ID!
  userId: ID!
}

input RejectMembershipInput {
  intentId: ID!
  userId: ID!
  note: String
}

input KickMemberInput {
  intentId: ID!
  userId: ID!
  note: String
}

input UpdateMemberRoleInput {
  intentId: ID!
  userId: ID!
  role: IntentMemberRole!
}

# NEW: Ban / Unban / Cancel pending-or-invite
input BanMemberInput {
  intentId: ID!
  userId: ID!
  note: String
}

input UnbanMemberInput {
  intentId: ID!
  userId: ID!
}

input CancelPendingOrInviteForUserInput {
  intentId: ID!
  userId: ID!
}

# DM Inputs
input SendDmMessageInput {
  recipientId: ID!
  content: String!
}

input UpdateDmMessageInput {
  content: String!
}

# Comment Inputs
input CreateCommentInput {
  intentId: ID!
  content: String!
  parentId: ID
}

input UpdateCommentInput {
  content: String!
}

# Review Inputs
input CreateReviewInput {
  intentId: ID!
  rating: Int!
  content: String
}

input UpdateReviewInput {
  rating: Int
  content: String
}

# Report Inputs
input CreateReportInput {
  entity: ReportEntity!
  entityId: ID!
  reason: String!
}

input UpdateReportStatusInput {
  status: ReportStatus!
}

# Event Chat Inputs
input SendIntentMessageInput {
  intentId: ID!
  content: String!
  replyToId: ID
}

input EditIntentMessageInput {
  content: String!
}

# Intent Invite Link Inputs
input CreateIntentInviteLinkInput {
  intentId: ID!
  maxUses: Int
  expiresAt: DateTime
}

# Notification Preference Inputs
input UpdateNotificationPreferenceInput {
  emailOnInvite: Boolean
  emailOnJoinRequest: Boolean
  emailOnMessage: Boolean
  pushOnReminder: Boolean
  inAppOnEverything: Boolean
}

# ------------------------------------------------------------------------------
# Queries
# ------------------------------------------------------------------------------

type Query {
  notifications(
    recipientId: ID!
    unreadOnly: Boolean = false
    entityType: NotificationEntity
    limit: Int = 50
    offset: Int = 0
  ): NotificationsResult!

  intents(
    limit: Int = 20
    offset: Int = 0
    visibility: Visibility
    joinMode: JoinMode
    ownerId: ID
    memberId: ID
    upcomingAfter: DateTime
    endingBefore: DateTime
    categorySlugs: [ID!]
    tagSlugs: [String!]
    levels: [Level!]
    kinds: [MeetingKind!]
    keywords: [String!]
    status: IntentStatus
    verifiedOnly: Boolean
    distanceKm: Int
    near: LocationInput
    sortBy: IntentsSortBy = START_AT
    sortDir: SortDir = ASC
  ): IntentsResult!

  intent(id: ID!): Intent

  intentMembers(
    intentId: ID!
    status: IntentMemberStatus
    role: IntentMemberRole
    limit: Int = 50
    offset: Int = 0
  ): [IntentMember!]!

  intentMember(intentId: ID!, userId: ID!): IntentMember

  myMemberships(
    status: IntentMemberStatus
    role: IntentMemberRole
    limit: Int = 50
    offset: Int = 0
  ): [IntentMember!]!

  intentMemberStats(intentId: ID!): IntentMemberStats!

  categoriesBySlugs(slugs: [String!]!, limit: Int): [Category!]!
  categories(query: String, limit: Int = 50): [Category!]!
  category(id: ID, slug: String): Category

  tagsBySlugs(slugs: [String!]!, limit: Int): [Tag!]!
  tags(query: String, limit: Int = 50): [Tag!]!
  tag(id: ID, slug: String): Tag

  users(
    limit: Int = 50
    offset: Int = 0
    q: String
    role: Role
    verifiedOnly: Boolean
    sortBy: UsersSortBy = CREATED_AT
    sortDir: SortDir = DESC
  ): UsersResult!

  user(id: ID!): User

  me: SessionUser

  # DM Queries
  dmThreads(
    limit: Int = 20
    offset: Int = 0
    unreadOnly: Boolean = false
  ): DmThreadsResult!

  dmThread(id: ID, otherUserId: ID): DmThread

  dmMessages(
    threadId: ID!
    limit: Int = 50
    offset: Int = 0
    beforeMessageId: ID
  ): [DmMessage!]!

  # Comment Queries
  comments(
    intentId: ID!
    limit: Int = 50
    offset: Int = 0
    threadId: ID
    parentId: ID
  ): CommentsResult!

  comment(id: ID!): Comment

  # Review Queries
  reviews(
    intentId: ID!
    limit: Int = 20
    offset: Int = 0
    rating: Int
  ): ReviewsResult!

  review(id: ID!): Review

  reviewStats(intentId: ID!): ReviewStats!

  myReview(intentId: ID!): Review

  # Report Queries (admin only)
  reports(
    limit: Int = 20
    offset: Int = 0
    status: ReportStatus
    entity: ReportEntity
  ): ReportsResult!

  report(id: ID!): Report

  # Event Chat Queries
  intentMessages(
    intentId: ID!
    after: String
    limit: Int = 50
  ): IntentChatMessagesResult!

  intentUnreadCount(intentId: ID!): Int!

  # User Block Queries
  myBlocks(limit: Int = 50, offset: Int = 0): UserBlocksResult!
  isBlocked(userId: ID!): Boolean!

  # Intent Invite Link Queries
  intentInviteLinks(intentId: ID!): [IntentInviteLink!]!
  intentInviteLink(code: String!): IntentInviteLink

  # Notification Preference Queries
  myNotificationPreferences: NotificationPreference!

  # Mute Queries
  intentMute(intentId: ID!): IntentMute
  dmMute(threadId: ID!): DmMute

  # Map Clustering Queries
  clusters(
    bbox: BBoxInput!
    zoom: Float!
    filters: ClusterFiltersInput
  ): [Cluster!]!

  regionIntents(
    region: String!
    page: Int = 1
    perPage: Int = 20
    filters: ClusterFiltersInput
  ): RegionIntentPage!
}

# ------------------------------------------------------------------------------
# Mutations
# ------------------------------------------------------------------------------
type Mutation {
  # categories & tags
  createCategory(input: CreateCategoryInput!): Category!
  updateCategory(id: ID!, input: UpdateCategoryInput!): Category!
  deleteCategory(id: ID!): Boolean!

  createTag(input: CreateTagInput!): Tag!
  updateTag(id: ID!, input: UpdateTagInput!): Tag!
  deleteTag(id: ID!): Boolean!

  # intents
  createIntent(input: CreateIntentInput!): Intent!
  updateIntent(id: ID!, input: UpdateIntentInput!): Intent!
  deleteIntent(id: ID!): Boolean!
  cancelIntent(id: ID!, reason: String): Intent!

  # memberships (user endpoints)
  requestJoinIntent(intentId: ID!): Intent!
  cancelJoinRequest(intentId: ID!): Boolean!
  leaveIntent(intentId: ID!): Intent!
  acceptInvite(intentId: ID!): Intent!

  # memberships (owner/mod endpoints)
  inviteMember(input: InviteMemberInput!): Intent!
  approveMembership(input: ApproveMembershipInput!): Intent!
  rejectMembership(input: RejectMembershipInput!): Intent!
  kickMember(input: KickMemberInput!): Intent!
  updateMemberRole(input: UpdateMemberRoleInput!): Intent!
  banMember(input: BanMemberInput!): Intent!
  unbanMember(input: UnbanMemberInput!): Intent!
  cancelPendingOrInviteForUser(
    input: CancelPendingOrInviteForUserInput!
  ): Boolean!

  # notifications
  addNotification(
    recipientId: ID!
    kind: NotificationKind! = SYSTEM
    title: String
    body: String
    data: JSON
    entityType: NotificationEntity! = OTHER
    entityId: ID
  ): Notification!

  markNotificationRead(id: ID!): Boolean!
  deleteNotification(id: ID!): Boolean!
  markAllNotificationsRead(recipientId: ID!): Int!

  # DM
  sendDmMessage(input: SendDmMessageInput!): DmMessage!
  updateDmMessage(id: ID!, input: UpdateDmMessageInput!): DmMessage!
  deleteDmMessage(id: ID!): Boolean!
  markDmMessageRead(id: ID!): Boolean!
  markDmThreadRead(threadId: ID!): Int!
  deleteDmThread(id: ID!): Boolean! # ← DODANE
  createOrGetDmThread(userId: ID!): DmThread!
  publishDmTyping(threadId: ID!, isTyping: Boolean!): Boolean!

  # Comments
  createComment(input: CreateCommentInput!): Comment!
  updateComment(id: ID!, input: UpdateCommentInput!): Comment!
  deleteComment(id: ID!): Boolean!

  # Reviews
  createReview(input: CreateReviewInput!): Review!
  updateReview(id: ID!, input: UpdateReviewInput!): Review!
  deleteReview(id: ID!): Boolean!

  # Reports
  createReport(input: CreateReportInput!): Report!
  updateReportStatus(id: ID!, input: UpdateReportStatusInput!): Report!
  deleteReport(id: ID!): Boolean!

  # Event Chat
  sendIntentMessage(input: SendIntentMessageInput!): IntentChatMessage!
  editIntentMessage(id: ID!, input: EditIntentMessageInput!): IntentChatMessage!
  deleteIntentMessage(id: ID!, soft: Boolean = true): Boolean!
  markIntentChatRead(intentId: ID!, at: DateTime): Boolean!
  publishIntentTyping(intentId: ID!, isTyping: Boolean!): Boolean!

  # User Blocks
  blockUser(userId: ID!): UserBlock! # ← DODANE
  unblockUser(userId: ID!): Boolean! # ← DODANE
  # Intent Invite Links
  createIntentInviteLink(input: CreateIntentInviteLinkInput!): IntentInviteLink! # ← DODANE
  deleteIntentInviteLink(id: ID!): Boolean! # ← DODANE
  useIntentInviteLink(code: String!): Intent! # ← DODANE
  # Notification Preferences
  updateNotificationPreferences(
    input: UpdateNotificationPreferenceInput!
  ): NotificationPreference! # ← DODANE
  # Mutes
  muteIntent(intentId: ID!, muted: Boolean!): IntentMute!
  muteDmThread(threadId: ID!, muted: Boolean!): DmMute!

  # dev only
  devLogin(name: String!): SessionUser
  devLogout: Boolean!
}

# ------------------------------------------------------------------------------
# Subscriptions (scoped per recipient)
# ------------------------------------------------------------------------------

type Subscription {
  notificationAdded(recipientId: ID!): Notification!
  notificationBadgeChanged(recipientId: ID!): NotificationBadgeChanged!

  # Event Chat Subscriptions
  intentMessageAdded(intentId: ID!): IntentChatMessage!
  intentTyping(intentId: ID!): TypingIndicator!

  # DM Subscriptions
  dmMessageAdded(threadId: ID!): DmMessage!
  dmTyping(threadId: ID!): TypingIndicator!
}

# Typing indicator for real-time presence
type TypingIndicator {
  userId: ID!
  isTyping: Boolean!
}

# ------------------------------------------------------------------------------
# User Blocks
# ------------------------------------------------------------------------------

"User block for preventing interactions"
type UserBlock {
  id: ID!
  blockerId: ID!
  blockedId: ID!
  createdAt: DateTime!

  blocker: User!
  blocked: User!
}

"Paginated user blocks result"
type UserBlocksResult {
  items: [UserBlock!]!
  pageInfo: PageInfo!
}

# ------------------------------------------------------------------------------
# Intent Invite Links
# ------------------------------------------------------------------------------

"Invite link for intent with usage limits"
type IntentInviteLink {
  id: ID!
  intentId: ID!
  code: String!
  maxUses: Int
  usedCount: Int!
  expiresAt: DateTime
  createdAt: DateTime!

  intent: Intent!

  # Computed
  isExpired: Boolean!
  isMaxedOut: Boolean!
  isValid: Boolean!
}

"Paginated invite links result"
type IntentInviteLinksResult {
  items: [IntentInviteLink!]!
  pageInfo: PageInfo!
}

# ------------------------------------------------------------------------------
# Notification Preferences
# ------------------------------------------------------------------------------

"User notification preferences"
type NotificationPreference {
  id: ID!
  userId: ID!
  emailOnInvite: Boolean!
  emailOnJoinRequest: Boolean!
  emailOnMessage: Boolean!
  pushOnReminder: Boolean!
  inAppOnEverything: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!

  user: User!
}

# ------------------------------------------------------------------------------
# Mutes (Intent & DM)
# ------------------------------------------------------------------------------

"Intent mute status"
type IntentMute {
  id: ID!
  intentId: ID!
  userId: ID!
  muted: Boolean!
  createdAt: DateTime!

  intent: Intent!
  user: User!
}

"DM thread mute status"
type DmMute {
  id: ID!
  threadId: ID!
  userId: ID!
  muted: Boolean!
  createdAt: DateTime!

  thread: DmThread!
  user: User!
}
