"""
Custom scalars
"""
scalar DateTime
scalar JSON
scalar JSONObject

"""
Visibility of an intent
"""
enum Visibility {
  PUBLIC
  HIDDEN
}

"""
Meeting mode / capacity grouping
"""
enum Mode {
  ONE_TO_ONE
  GROUP
}

"""
How the meeting happens
"""
enum MeetingKind {
  ONSITE
  ONLINE
  HYBRID
}

"""
Notification kind â€“ extensible
"""
enum NotificationKind {
  INTENT_CREATED
  # add more kinds over time, e.g. INTENT_UPDATED, INVITE, REMINDER, ...
}

"""
User role
"""
enum Role {
  ADMIN
  MODERATOR
  USER
}

"""
Skill / difficulty level (enum array in DB)
"""
enum Level {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

"""
Basic demo entity kept from your initial setup
"""
type Event {
  id: ID!
  title: String!
  createdAt: DateTime!
}

"""
User
"""
type User {
  id: ID!
  email: String!
  name: String
  imageUrl: String
  role: Role! # <-- added
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Category with translated names in JSON, e.g. { "pl": "...", "de": "...", "en": "..." }
"""
type Category {
  id: ID!
  slug: String!
  names: JSON!
  icon: String
  color: String
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Tag used for search/filtering
"""
type Tag {
  id: ID!
  label: String!
  slug: String!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Intent
"""
type Intent {
  id: ID!
  title: String!
  description: String
  notes: String

  categories: [Category!]!
  tags: [Tag!]!

  visibility: Visibility!
  mode: Mode!
  min: Int!
  max: Int!

  startAt: DateTime!
  endAt: DateTime!
  allowJoinLate: Boolean!

  meetingKind: MeetingKind!
  onlineUrl: String

  lat: Float
  lng: Float
  address: String
  radiusKm: Float

  # PostgreSQL enum[]
  levels: [Level!]!

  authorId: ID
  author: User

  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Notification stored in DB, assigned to a recipient and optionally linked to an intent
"""
type Notification {
  id: ID!
  kind: NotificationKind!
  message: String
  payload: JSON
  readAt: DateTime
  createdAt: DateTime!

  recipientId: ID!
  recipient: User!

  intentId: ID
  intent: Intent
}

"""
Inputs
"""
input CreateCategoryInput {
  slug: String!
  names: JSON!
  icon: String
  color: String
}

input UpdateCategoryInput {
  slug: String
  names: JSON
  icon: String
  color: String
}

input CreateTagInput {
  label: String!
  slug: String!
}

input UpdateTagInput {
  label: String
  slug: String
}

input LocationInput {
  lat: Float
  lng: Float
  address: String
  radiusKm: Float
}

input CreateIntentInput {
  title: String!
  categoryIds: [ID!]! # was: interestIds
  tagIds: [ID!]
  description: String
  notes: String

  visibility: Visibility!
  mode: Mode!
  min: Int!
  max: Int!

  startAt: DateTime!
  endAt: DateTime!
  allowJoinLate: Boolean!

  meetingKind: MeetingKind!
  onlineUrl: String

  authorId: ID
  location: LocationInput
  levels: [Level!]
}

input UpdateIntentInput {
  title: String
  categoryIds: [ID!]
  tagIds: [ID!]
  description: String
  notes: String

  visibility: Visibility
  mode: Mode
  min: Int
  max: Int

  startAt: DateTime
  endAt: DateTime
  allowJoinLate: Boolean

  meetingKind: MeetingKind
  onlineUrl: String

  location: LocationInput
  levels: [Level!]
}

"""
Queries
"""
type Query {
  events(limit: Int = 10): [Event!]!

  notifications(recipientId: ID): [Notification!]!

  intents(
    limit: Int = 20
    offset: Int = 0
    visibility: Visibility
    authorId: ID
    upcomingAfter: DateTime
    categoryIds: [ID!]
    tagIds: [ID!]
    levels: [Level!]
  ): [Intent!]!

  intent(id: ID!): Intent

  categories(query: String, limit: Int = 50): [Category!]!
  category(id: ID, slug: String): Category

  tags(query: String, limit: Int = 50): [Tag!]!
  tag(id: ID, slug: String): Tag

  users(limit: Int = 50, offset: Int = 0): [User!]!
  user(id: ID!): User
}

"""
Mutations
"""
type Mutation {
  addNotification(message: String): Notification

  createCategory(input: CreateCategoryInput!): Category!
  updateCategory(id: ID!, input: UpdateCategoryInput!): Category!
  deleteCategory(id: ID!): Boolean!

  createTag(input: CreateTagInput!): Tag!
  updateTag(id: ID!, input: UpdateTagInput!): Tag!
  deleteTag(id: ID!): Boolean!

  createIntent(input: CreateIntentInput!): Intent!
  updateIntent(id: ID!, input: UpdateIntentInput!): Intent!
  deleteIntent(id: ID!): Boolean!
}

"""
Subscriptions (scoped per recipient)
"""
type Subscription {
  notificationAdded(recipientId: ID!): Notification!
}
