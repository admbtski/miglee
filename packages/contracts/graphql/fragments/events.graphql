# =============================================================================
# Event Fragments
# =============================================================================
# Fragments for event/event entities at different levels of detail.

#import "./_core.graphql"
#import "./_pagination.graphql"

# -----------------------------------------------------------------------------
# Event Fragments
# -----------------------------------------------------------------------------

# Minimal fragment optimized for event cards in lists/grids
# Contains ONLY fields actually used in EventCard component
fragment EventCardData on Event {
  id
  title

  # Capacity
  min
  max

  # Dates
  startAt
  endAt

  # Join configuration
  allowJoinLate
  joinOpensMinutesBeforeStart
  joinCutoffMinutesBeforeStart
  lateJoinCutoffMinutesAfterStart
  joinManuallyClosed

  # Location
  meetingKind
  lat
  lng
  address
  radiusKm
  addressVisibility

  # Media
  coverKey
  coverBlurhash

  # Computed fields for card display
  joinedCount
  hasStarted
  isCanceled
  isDeleted
  canJoin
  isOnsite
  isOnline
  isHybrid
  isFavourite

  # Boost status
  boostedAt

  # Appearance customization
  appearance {
    id
    config
  }

  # Relations (minimal)
  categories {
    ...CategoryCore
  }

  owner {
    id
    name
    avatarKey
    avatarBlurhash
    verifiedAt
  }
}

# Lightweight event fragment (for lists/cards)
fragment EventLight on Event {
  id
  title
  description

  visibility
  joinMode
  mode
  min
  max

  startAt
  endAt

  # Join windows / status
  status
  allowJoinLate
  joinOpensMinutesBeforeStart
  joinCutoffMinutesBeforeStart
  lateJoinCutoffMinutesAfterStart
  joinManuallyClosed
  joinOpen
  lockReason

  meetingKind
  onlineUrl

  lat
  lng
  address
  placeId
  radiusKm

  levels

  # Media
  coverKey
  coverBlurhash

  addressVisibility
  membersVisibility

  # Derived / computed
  joinedCount
  commentsCount
  messagesCount
  isFull
  hasStarted
  hasEnded
  isCanceled
  isDeleted
  canJoin
  isOngoing

  # Publication status
  publicationStatus
  publishedAt
  scheduledPublishAt

  ownerId

  createdAt
  updatedAt
  boostedAt
  sponsorshipPlan

  # Check-in configuration
  checkinEnabled
  enabledCheckinMethods
  eventCheckinToken

  # Appearance customization
  appearance {
    id
    config
  }

  categories {
    ...CategoryCore
  }
  tags {
    ...TagCore
  }

  owner {
    ...UserLight
  }
}

# Full event fragment (for detail views)
fragment EventCore on Event {
  id
  title
  description
  notes

  visibility
  joinMode
  mode
  min
  max

  startAt
  endAt

  # Join windows / cutoffs / manual lock
  allowJoinLate
  joinOpensMinutesBeforeStart
  joinCutoffMinutesBeforeStart
  lateJoinCutoffMinutesAfterStart
  joinManuallyClosed
  joinManuallyClosedAt
  joinManuallyClosedBy {
    ...UserLight
  }
  joinManualCloseReason

  meetingKind
  onlineUrl

  lat
  lng
  address
  placeId
  radiusKm

  levels

  # Media
  coverKey
  coverBlurhash

  addressVisibility
  membersVisibility

  # Computed helpers (resolver-calculated)
  status
  joinedCount
  commentsCount
  messagesCount
  isFull
  hasStarted
  hasEnded
  canJoin
  joinOpen
  lockReason
  isOngoing
  withinLock
  isOnsite
  isOnline
  isHybrid
  isFavourite
  savedCount

  # Ownership
  ownerId

  # Cancellation (read-only)
  canceledAt
  canceledBy {
    ...UserCore
  }
  cancelReason
  isCanceled

  # Soft-delete (read-only)
  deletedAt
  deletedBy {
    ...UserCore
  }
  deleteReason
  isDeleted

  # Publication status
  publicationStatus
  publishedAt
  scheduledPublishAt

  createdAt
  updatedAt
  boostedAt
  sponsorshipPlan

  # Check-in configuration
  checkinEnabled
  enabledCheckinMethods
  eventCheckinToken

  # Appearance customization
  appearance {
    id
    config
  }

  categories {
    ...CategoryCore
  }
  tags {
    ...TagCore
  }

  # Convenience relations (access-controlled)
  owner {
    ...UserCore
  }

  sponsorship {
    plan
    status
    startsAt
    endsAt
    boostsTotal
    boostsUsed
    localPushesTotal
    localPushesUsed
    sponsor {
      id
      name
    }
  }
}

# Extended event fragment for detail page (includes sponsorship, inviteLinks, members, faqs)
fragment EventDetail on Event {
  ...EventCore
  members {
    ...EventMemberCore
  }
  sponsorship {
    plan
    status
    startsAt
    endsAt
    boostsTotal
    boostsUsed
    localPushesTotal
    localPushesUsed
    sponsor {
      id
      name
    }
  }
  faqs {
    id
    eventId
    order
    question
    answer
    createdAt
    updatedAt
  }
  joinQuestions {
    id
    eventId
    order
    type
    label
    helpText
    required
    options
    maxLength
    createdAt
    updatedAt
  }
  agendaItems {
    id
    eventId
    order
    title
    description
    startAt
    endAt
    hosts {
      id
      agendaItemId
      order
      kind
      userId
      user {
        id
        name
        avatarKey
        avatarBlurhash
      }
      name
      avatarUrl
    }
    createdAt
    updatedAt
  }
}

# -----------------------------------------------------------------------------
# Result Wrappers
# -----------------------------------------------------------------------------

fragment EventsListingResult on EventsResult {
  items {
    ...EventCardData
  }
  pageInfo {
    ...PageInfoCore
  }
}

fragment EventsResultCore on EventsResult {
  items {
    ...EventCore
  }
  pageInfo {
    ...PageInfoCore
  }
}
