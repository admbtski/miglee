# =============================================================================
# Prometheus Configuration - Metrics Storage
# =============================================================================
#
# Prometheus scrapes and stores metrics.
# This configuration includes:
#   - Scrape configs for all observability components
#   - Exemplar support enabled
#   - Remote write receiver enabled
#
# =============================================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    environment: development
    cluster: local

# Alertmanager configuration (optional, using Grafana Alerting instead)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: []

# Rule files (we use Grafana Alerting, but can add here too)
rule_files: []

# Scrape configurations
scrape_configs:
  # Self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    scrape_interval: 30s

  # OpenTelemetry Collector (self-metrics)
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['otel-collector:8888']
    scrape_interval: 15s

  # OpenTelemetry Collector (app metrics via prometheus exporter)
  - job_name: 'otel-collector-apps'
    static_configs:
      - targets: ['otel-collector:8889']
    scrape_interval: 15s
    honor_labels: true

  # Tempo metrics
  - job_name: 'tempo'
    static_configs:
      - targets: ['tempo:3200']
    scrape_interval: 30s

  # Loki metrics
  - job_name: 'loki'
    static_configs:
      - targets: ['loki:3100']
    scrape_interval: 30s

  # Grafana metrics
  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
    scrape_interval: 30s

  # Application API (if exposing /metrics endpoint directly)
  # Uncomment when API exposes Prometheus metrics
  # - job_name: 'appname-api'
  #   static_configs:
  #     - targets: ['host.docker.internal:4000']
  #   scrape_interval: 15s
  #   metrics_path: /metrics

# Remote write configuration (for receiving metrics from OTel Collector)
# Enabled via --web.enable-remote-write-receiver flag

